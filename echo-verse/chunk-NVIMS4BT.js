import{a as n,d as u,j as o}from"./chunk-AM3MBALI.js";var y=class a{synth;voices=[];playlist=[];currentIndexInPlaylist=-1;sentenceDelay=0;playbackState=new u({isPlaying:!1,isPaused:!1,currentSentenceIndex:null});playbackState$=this.playbackState.asObservable();constructor(){this.synth=window.speechSynthesis,this.synth.onvoiceschanged=()=>{this.voices=this.synth.getVoices()}}getVoices(){return this.voices.length===0&&(this.voices=this.synth.getVoices()),this.voices}play(e,i,p,S,d,v,I){this.stop(),this.sentenceDelay=I;let l=this.voices.find(s=>s.voiceURI===S)||null;e.forEach((s,r)=>{if(i[r])for(let c=0;c<p;c++){let t=new SpeechSynthesisUtterance(s);l&&(t.voice=l),t.rate=Math.max(.1,Math.min(10,d)),t.volume=Math.max(0,Math.min(1,v)),t.onend=()=>this._playNext(),t.onerror=h=>{h.error!=="interrupted"&&console.error("SpeechSynthesisUtterance.onerror:",h),this._playNext()},this.playlist.push({utterance:t,originalSentenceIndex:r})}}),this.playlist.length>0&&(this.updateState({isPlaying:!0,isPaused:!1}),this._playNext())}_playNext(){!this.playbackState.value.isPlaying||this.playbackState.value.isPaused||setTimeout(()=>{!this.playbackState.value.isPlaying||this.playbackState.value.isPaused||(this.currentIndexInPlaylist++,this.currentIndexInPlaylist<this.playlist.length?this._speakCurrentItem():this.stop())},this.currentIndexInPlaylist===-1?0:this.sentenceDelay)}_speakCurrentItem(){if(this.currentIndexInPlaylist<0||this.currentIndexInPlaylist>=this.playlist.length)return;let e=this.playlist[this.currentIndexInPlaylist];this.updateState({currentSentenceIndex:e.originalSentenceIndex}),this.synth.speak(e.utterance)}pause(){this.playbackState.value.isPlaying&&!this.playbackState.value.isPaused&&(this.updateState({isPaused:!0}),this.synth.cancel())}resume(){this.playbackState.value.isPlaying&&this.playbackState.value.isPaused&&(this.updateState({isPaused:!1}),this._speakCurrentItem())}stop(){this.updateState({isPlaying:!1,isPaused:!1,currentSentenceIndex:null}),this.playlist=[],this.currentIndexInPlaylist=-1,this.synth.speaking&&this.synth.cancel()}updateState(e){this.playbackState.next(n(n({},this.playbackState.value),e))}static \u0275fac=function(i){return new(i||a)};static \u0275prov=o({token:a,factory:a.\u0275fac,providedIn:"root"})};export{y as a};
