import{a as z}from"./chunk-NVIMS4BT.js";import{a as F,b as N,d as W,f as L,h as j,o as U,q}from"./chunk-SXBCIAQM.js";import{a as B}from"./chunk-BHYHBSD6.js";import{C as _,F as d,G as y,H as w,I as s,J as r,K as k,L as M,M as O,N as S,O as u,P as c,T as l,U as v,V,X as f,Y as b,Z as C,ja as I,ka as T,na as E,o as p,p as g,pa as D,sa as A,u as a,ua as R,x as h,y as P}from"./chunk-AM3MBALI.js";function H(o,i){if(o&1){let e=S();s(0,"button",9),u("click",function(){p(e);let n=c(2);return g(n.startPlayback())}),l(1," \u64AD\u653E "),r()}}function J(o,i){if(o&1){let e=S();M(0),s(1,"button",9),u("click",function(){p(e);let n=c(2);return g(n.togglePauseResume())}),l(2),r(),s(3,"button",13),u("click",function(){p(e);let n=c(2);return g(n.stopPlayback())}),l(4," \u5168\u90E8\u505C\u6B62 "),r(),O()}if(o&2){let e=c(2);a(2),V(" ",e.playbackState.isPaused?"\u7E7C\u7E8C":"\u66AB\u505C"," ")}}function K(o,i){if(o&1&&(s(0,"div",14),k(1,"div",15),r()),o&2){let e=c(2);a(),y("width",e.progress,"%")}}function Q(o,i){if(o&1){let e=S();s(0,"li")(1,"label",16)(2,"input",17),C("ngModelChange",function(n){let m=p(e).index,x=c(2);return b(x.selectedSentences[m],n)||(x.selectedSentences[m]=n),g(n)}),u("change",function(){p(e);let n=c(2);return g(n.saveSessionSettings())}),r(),s(3,"span"),l(4),r()()()}if(o&2){let e=i.$implicit,t=i.index,n=c(2);w("playing",n.playbackState.currentSentenceIndex===t&&!n.playbackState.isPaused),a(2),f("ngModel",n.selectedSentences[t]),a(2),v(e)}}function X(o,i){if(o&1){let e=S();s(0,"div",1)(1,"h2"),l(2),r(),s(3,"div",2)(4,"label",3),l(5,"\u91CD\u8907\u6B21\u6578:"),r(),s(6,"input",4),C("ngModelChange",function(n){p(e);let m=c();return b(m.repeatCount,n)||(m.repeatCount=n),g(n)}),r(),_(7,H,2,0,"button",5)(8,J,5,1,"ng-container",6),r(),_(9,K,2,2,"div",7),s(10,"div",8)(11,"button",9),u("click",function(){p(e);let n=c();return g(n.toggleSelectAll())}),l(12,"\u5168\u9078 / \u5168\u90E8\u53D6\u6D88"),r()(),s(13,"ul",10),_(14,Q,5,4,"li",11),r(),s(15,"button",12),l(16,"\u8FD4\u56DE\u5217\u8868"),r()()}if(o&2){let e=c();a(2),v(e.text.title),a(4),f("ngModel",e.repeatCount),a(),d("ngIf",!e.playbackState.isPlaying),a(),d("ngIf",e.playbackState.isPlaying),a(),d("ngIf",e.playbackState.isPlaying),a(5),d("ngForOf",e.sentences)}}var G=class o{constructor(i,e,t){this.route=i;this.storageService=e;this.ttsService=t;this.appSettings=this.storageService.getSettings(),this.repeatCount=this.appSettings.defaultRepeatCount}text;sentences=[];selectedSentences=[];repeatCount=1;appSettings;playbackState={isPlaying:!1,isPaused:!1,currentSentenceIndex:null};progress=0;playbackSub;ngOnInit(){let i=this.route.snapshot.paramMap.get("id");if(i&&(this.text=this.storageService.getTextById(i),this.text)){this.sentences=this.splitTextIntoSentences(this.text.content);let e=this.storageService.getPracticeSessionSettings(i);e.selectedSentences.length===this.sentences.length?this.selectedSentences=e.selectedSentences:this.selectedSentences=new Array(this.sentences.length).fill(!0)}this.playbackSub=this.ttsService.playbackState$.subscribe(e=>{this.playbackState=e,this.updateProgress()})}splitTextIntoSentences(i){return i?i.split(/(?<=[.?!])\s+/).map(t=>t.trim()).filter(t=>t):[]}startPlayback(){this.sentences.length>0&&this.ttsService.play(this.sentences,this.selectedSentences,this.repeatCount,this.appSettings.ttsVoiceURI,this.appSettings.rate,this.appSettings.volume,this.appSettings.sentenceDelay)}togglePauseResume(){this.playbackState.isPaused?this.ttsService.resume():this.ttsService.pause()}stopPlayback(){this.ttsService.stop()}toggleSelectAll(){let e=!this.selectedSentences.every(t=>t===!0);this.selectedSentences.fill(e),this.saveSessionSettings()}saveSessionSettings(){this.text&&this.storageService.savePracticeSessionSettings(this.text.id,{selectedSentences:this.selectedSentences})}updateProgress(){if(this.playbackState.isPlaying&&this.playbackState.currentSentenceIndex!==null){let i=this.selectedSentences.filter(Boolean).length;if(i===0){this.progress=0;return}let e=0;for(let t=0;t<=this.playbackState.currentSentenceIndex;t++)this.selectedSentences[t]&&e++;this.progress=e/i*100}else this.progress=0}ngOnDestroy(){this.ttsService.stop(),this.playbackSub?.unsubscribe()}static \u0275fac=function(e){return new(e||o)(h(D),h(B),h(z))};static \u0275cmp=P({type:o,selectors:[["app-practice-view"]],decls:1,vars:1,consts:[["class","container practice-view",4,"ngIf"],[1,"container","practice-view"],[1,"controls"],["for","repeat"],["id","repeat","type","number","min","1",3,"ngModelChange","ngModel"],[3,"click",4,"ngIf"],[4,"ngIf"],["class","progress-bar",4,"ngIf"],[1,"list-actions"],[3,"click"],[1,"sentence-list"],[3,"playing",4,"ngFor","ngForOf"],["type","button","routerLink","/"],[1,"stop-button",3,"click"],[1,"progress-bar"],[1,"progress"],[1,"sentence-label"],["type","checkbox",3,"ngModelChange","change","ngModel"]],template:function(e,t){e&1&&_(0,X,17,6,"div",0),e&2&&d("ngIf",t.text)},dependencies:[E,I,T,q,N,j,F,W,U,L,R,A],styles:[".controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}.controls[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700}.controls[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:80px}.controls[_ngcontent-%COMP%]   .stop-button[_ngcontent-%COMP%]{background-color:var(--danger-color)}.controls[_ngcontent-%COMP%]   .stop-button[_ngcontent-%COMP%]:hover{background-color:var(--danger-hover-color)}.progress-bar[_ngcontent-%COMP%]{width:100%;height:8px;background-color:#e9ecef;border-radius:4px;margin-bottom:1rem;overflow:hidden}.progress[_ngcontent-%COMP%]{height:100%;background-color:var(--primary-color);width:0%;transition:width .3s ease-in-out}.list-actions[_ngcontent-%COMP%]{margin-bottom:1rem}.list-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--secondary-color);width:auto}.list-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--secondary-hover-color)}.sentence-list[_ngcontent-%COMP%]{list-style-type:none;padding:0;max-height:60vh;overflow-y:auto}.sentence-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:0;margin-bottom:.25rem;border:1px solid transparent;border-radius:5px;transition:background-color .3s ease,border-color .3s ease}.sentence-list[_ngcontent-%COMP%]   li.playing[_ngcontent-%COMP%]{background-color:#e7f3ff;border-color:var(--primary-color)}.sentence-label[_ngcontent-%COMP%]{display:flex;align-items:flex-start;cursor:pointer;width:100%;padding:.8rem;border-radius:4px;transition:background-color .2s ease}.sentence-label[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.sentence-list[_ngcontent-%COMP%]   li.playing[_ngcontent-%COMP%]   .sentence-label[_ngcontent-%COMP%]:hover{background-color:#d0e8ff}.sentence-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:auto;margin-right:1rem;margin-top:.2rem}.sentence-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex-grow:1;line-height:1.5}"]})};export{G as PracticeViewComponent};
